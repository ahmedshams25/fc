<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بطولة fc - 3 فرق لكل لاعب</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Import the functions you need from the SDKs you need -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <style>
        :root {
            --primary: #1a1a1a;
            --secondary: #00cc66; /* اللون الأخضر */
            --accent: #ff4757;
            --light: #2d2d2d;
            --dark: #121212;
            --text: #e0e0e0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
        }
        
        body {
            background-color: var(--dark);
            color: var(--text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }
        
        header {
            background-color: var(--primary);
            color: var(--text);
            text-align: center;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--secondary);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .section {
            background-color: var(--primary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 1px solid #333;
        }
        
        h2 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.4rem;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text);
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #333;
            color: var(--text);
        }
        
        button {
            background-color: var(--secondary);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #00b359;
        }
        
        .btn-danger {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #ff2e43;
        }
        
        .player {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
            border: 1px solid #444;
        }
        
        .player h3 {
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .team-list {
            list-style: none;
        }
        
        .team-list li {
            background-color: #333;
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--secondary);
        }
        
        .remove-team {
            color: var(--accent);
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 5px;
        }
        
        .remove-player {
            position: absolute;
            top: 10px;
            left: 10px;
            color: var(--accent);
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .tournament-status {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background-color: var(--light);
            border-radius: 8px;
            font-weight: bold;
            border: 1px solid #444;
        }
        
        .match {
            background-color: var(--primary);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border-top: 4px solid var(--secondary);
            border: 1px solid #444;
        }
        
        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .match-team {
            flex: 1;
            text-align: center;
            padding: 5px;
        }
        
        .match-vs {
            font-weight: bold;
            padding: 0 10px;
        }
        
        .match-result {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        
        .match-result input {
            width: 50px;
            text-align: center;
            margin: 0 5px;
            background-color: #333;
            color: var(--text);
            border: 1px solid #444;
        }
        
        .match-submit {
            margin-top: 10px;
        }
        
        .winner {
            background-color: #2d4a2d;
            border-left: 4px solid var(--secondary);
        }
        
        .loser {
            background-color: #4a2d2d;
            border-left: 4px solid var(--accent);
        }
        
        .hidden {
            display: none;
        }
        
        .sync-status {
            text-align: center;
            padding: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-radius: 5px;
            background-color: #333;
        }
        
        .sync-success {
            color: var(--secondary);
        }
        
        .sync-error {
            color: var(--accent);
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
            }
            
            .players-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .player {
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>بطولة fc - 3 فرق لكل لاعب</h1>
            <p>قم بتنظيم بطولتك مع الأصدقاء</p>
        </header>
        
        <section class="section" id="setup-section">
            <h2>إعداد البطولة</h2>
            
            <div class="form-group">
                <label for="player-name">اسم اللاعب</label>
                <select id="player-name">
                    <option value="">-- اختر اسم اللاعب --</option>
                    <option value="Shams">Shams</option>
                    <option value="Osama">Osama</option>
                    <option value="EL Gamal">EL Gamal</option>
                    <option value="other">اسم آخر...</option>
                </select>
                <input type="text" id="custom-player-name" class="hidden" placeholder="أدخل اسم اللاعب">
            </div>
            
            <div class="form-group">
                <label for="team-select">اختر فريق</label>
                <select id="team-select">
                    <option value="">-- اختر فريق --</option>
                    <option value="ريال مدريد">ريال مدريد</option>
                    <option value="برشلونة">برشلونة</option>
                    <option value="بايرن ميونخ">بايرن ميونخ</option>
                    <option value="مانشستر سيتي">مانشستر سيتي</option>
                    <option value="ليفربول">ليفربول</option>
                    <option value="باريس سان جيرمان">باريس سان جيرمان</option>
                    <option value="يوفنتوس">يوفنتوس</option>
                    <option value="تشيلسي">تشيلسي</option>
                    <option value="مانشستر يونايتد">مانشستر يونايتد</option>
                    <option value="أرسنال">أرسنال</option>
                    <option value="أتلتيكو مدريد">أتلتيكو مدريد</option>
                    <option value="إنتر ميلان">إنتر ميلان</option>
                    <option value="ميلان">ميلان</option>
                    <option value="توتنهام">توتنهام</option>
                    <option value="دورتموند">دورتموند</option>
                    <option value="أخرى...">أخرى...</option>
                </select>
            </div>
            
            <div class="form-group hidden" id="custom-team-group">
                <label for="custom-team">اسم الفريق المخصص</label>
                <input type="text" id="custom-team" placeholder="أدخل اسم الفريق">
            </div>
            
            <button id="add-team-btn">إضافة فريق للاعب</button>
            <button id="add-player-btn">إضافة لاعب جديد</button>
            <button id="start-tournament-btn" class="hidden">بدء البطولة</button>
            <div id="sync-status" class="sync-status"></div>
        </section>
        
        <section class="section" id="players-section">
            <h2>اللاعبون وفرقهم</h2>
            <div id="players-container" class="players-container">
                <!-- سيتم إضافة اللاعبين هنا -->
            </div>
        </section>
        
        <section class="section hidden" id="tournament-section">
            <h2>البطولة</h2>
            <div id="tournament-status" class="tournament-status">
                جاري إعداد المباريات...
            </div>
            <div id="matches-container">
                <!-- سيتم إضافة المباريات هنا -->
            </div>
        </section>
        
        <section class="section hidden" id="results-section">
            <h2>النتائج النهائية</h2>
            <div id="final-results">
                <!-- سيتم عرض النتائج النهائية هنا -->
            </div>
        </section>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD5gpwJFHEFr1ePwdQ6sV_kUVXomtVss9U",
            authDomain: "fc-mobile-9502f.firebaseapp.com",
            projectId: "fc-mobile-9502f",
            storageBucket: "fc-mobile-9502f.firebasestorage.app",
            messagingSenderId: "306392548442",
            appId: "1:306392548442:web:fb0f8467a407675ae24463",
            measurementId: "G-T7EXKHF2DE"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        const db = firebase.firestore();
        
        document.addEventListener('DOMContentLoaded', function() {
            // العناصر الرئيسية
            const playerNameSelect = document.getElementById('player-name');
            const customPlayerNameInput = document.getElementById('custom-player-name');
            const teamSelect = document.getElementById('team-select');
            const customTeamGroup = document.getElementById('custom-team-group');
            const customTeamInput = document.getElementById('custom-team');
            const addTeamBtn = document.getElementById('add-team-btn');
            const addPlayerBtn = document.getElementById('add-player-btn');
            const startTournamentBtn = document.getElementById('start-tournament-btn');
            const playersContainer = document.getElementById('players-container');
            const setupSection = document.getElementById('setup-section');
            const tournamentSection = document.getElementById('tournament-section');
            const resultsSection = document.getElementById('results-section');
            const matchesContainer = document.getElementById('matches-container');
            const tournamentStatus = document.getElementById('tournament-status');
            const finalResults = document.getElementById('final-results');
            const syncStatus = document.getElementById('sync-status');
            
            // بيانات التطبيق
            let players = [];
            let currentPlayer = null;
            let matches = [];
            let tournamentStarted = false;
            let unsubscribe = null;
            
            // إظهار/إخفاء حقل الاسم المخصص
            playerNameSelect.addEventListener('change', function() {
                if (this.value === 'other') {
                    customPlayerNameInput.classList.remove('hidden');
                } else {
                    customPlayerNameInput.classList.add('hidden');
                }
            });
            
            // إظهار/إخفاء حقل الفريق المخصص
            teamSelect.addEventListener('change', function() {
                if (this.value === 'أخرى...') {
                    customTeamGroup.classList.remove('hidden');
                } else {
                    customTeamGroup.classList.add('hidden');
                }
            });
            
            // تهيئة التطبيق
            function initApp() {
                // تحميل البيانات من Firebase
                loadData();
                
                // إعداد المزامنة التلقائية
                setupAutoSync();
            }
            
            // تحميل البيانات من Firebase
            function loadData() {
                updateSyncStatus("جاري تحميل البيانات...");
                
                // الاشتراك في التحديثات الفورية
                unsubscribe = db.collection("tournaments").doc("current")
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            players = data.players || [];
                            matches = data.matches || [];
                            tournamentStarted = data.tournamentStarted || false;
                            
                            renderPlayers();
                            updateRemainingTeams();
                            
                            if (tournamentStarted) {
                                setupSection.classList.add('hidden');
                                tournamentSection.classList.remove('hidden');
                                renderMatches();
                                checkTournamentWinner();
                            }
                            
                            updateSyncStatus("تم تحميل البيانات بنجاح", true);
                        } else {
                            updateSyncStatus("لا توجد بيانات سابقة", true);
                        }
                    }, (error) => {
                        console.error("Error loading data:", error);
                        updateSyncStatus("خطأ في تحميل البيانات: " + error.message, false);
                    });
            }
            
            // إعداد المزامنة التلقائية
            function setupAutoSync() {
                // حفظ البيانات تلقائياً عند أي تغيير
                setInterval(saveData, 10000); // كل 10 ثواني
            }
            
            // حفظ البيانات إلى Firebase
            function saveData() {
                const tournamentData = {
                    players: players,
                    matches: matches,
                    tournamentStarted: tournamentStarted,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                db.collection("tournaments").doc("current").set(tournamentData)
                    .then(() => {
                        updateSyncStatus("تم حفظ البيانات تلقائياً", true);
                    })
                    .catch((error) => {
                        console.error("Error saving data:", error);
                        updateSyncStatus("خطأ في حفظ البيانات: " + error.message, false);
                    });
            }
            
            // تحديث حالة المزامنة
            function updateSyncStatus(message, isSuccess = null) {
                syncStatus.textContent = message;
                syncStatus.className = 'sync-status';
                
                if (isSuccess === true) {
                    syncStatus.classList.add('sync-success');
                } else if (isSuccess === false) {
                    syncStatus.classList.add('sync-error');
                }
            }
            
            // عرض الفرق المتبقية لكل لاعب
            function updateRemainingTeams() {
                const playersWithTeams = players.filter(player => player.teams.length > 0);
                if (playersWithTeams.length >= 2) {
                    startTournamentBtn.classList.remove('hidden');
                } else {
                    startTournamentBtn.classList.add('hidden');
                }
            }
            
            // إضافة فريق للاعب الحالي
            addTeamBtn.addEventListener('click', function() {
                let playerName = playerNameSelect.value;
                
                if (playerName === 'other') {
                    playerName = customPlayerNameInput.value.trim();
                }
                
                let teamName = teamSelect.value;
                
                if (teamName === 'أخرى...') {
                    teamName = customTeamInput.value.trim();
                }
                
                if (!playerName) {
                    alert('الرجاء إدخال اسم اللاعب');
                    return;
                }
                
                if (!teamName) {
                    alert('الرجاء اختيار أو إدخال اسم الفريق');
                    return;
                }
                
                // البحث عن اللاعب الحالي أو إنشاء لاعب جديد
                let player = players.find(p => p.name === playerName);
                
                if (!player) {
                    player = { name: playerName, teams: [] };
                    players.push(player);
                }
                
                // التحقق من أن اللاعب ليس لديه 3 فرق بالفعل
                if (player.teams.length >= 3) {
                    alert('كل لاعب يمكنه اختيار 3 فرق فقط');
                    return;
                }
                
                // التحقق من أن الفريق لم يتم اختياره من قبل
                const teamAlreadyTaken = players.some(p => 
                    p.teams.some(t => t.name === teamName)
                );
                
                if (teamAlreadyTaken) {
                    alert('هذا الفريق已被另一玩家選擇了');
                    return;
                }
                
                // إضافة الفريق للاعب
                player.teams.push({ name: teamName, eliminated: false });
                currentPlayer = player;
                
                // تحديث العرض
                renderPlayers();
                updateRemainingTeams();
                
                // حفظ البيانات
                saveData();
                
                // مسح الحقول
                teamSelect.value = '';
                customTeamInput.value = '';
                customTeamGroup.classList.add('hidden');
            });
            
            // إضافة لاعب جديد
            addPlayerBtn.addEventListener('click', function() {
                playerNameSelect.value = '';
                customPlayerNameInput.value = '';
                customPlayerNameInput.classList.add('hidden');
                teamSelect.value = '';
                customTeamInput.value = '';
                customTeamGroup.classList.add('hidden');
                currentPlayer = null;
            });
            
            // بدء البطولة
            startTournamentBtn.addEventListener('click', function() {
                if (players.filter(p => p.teams.length > 0).length < 2) {
                    alert('يجب أن يكون هناك على الأقل لاعبين لديهم فرق للمشاركة');
                    return;
                }
                
                tournamentStarted = true;
                setupSection.classList.add('hidden');
                tournamentSection.classList.remove('hidden');
                
                // إنشاء المباريات
                generateMatches();
                renderMatches();
                
                // حفظ البيانات
                saveData();
            });
            
            // عرض اللاعبين وفرقهم
            function renderPlayers() {
                playersContainer.innerHTML = '';
                
                players.forEach(player => {
                    if (player.teams.length === 0) return;
                    
                    const playerEl = document.createElement('div');
                    playerEl.className = 'player';
                    
                    const playerTitle = document.createElement('h3');
                    playerTitle.textContent = player.name;
                    
                    const teamList = document.createElement('ul');
                    teamList.className = 'team-list';
                    
                    player.teams.forEach((team, index) => {
                        const teamItem = document.createElement('li');
                        teamItem.textContent = team.name;
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-team';
                        removeBtn.innerHTML = '&times;';
                        removeBtn.addEventListener('click', () => {
                            player.teams.splice(index, 1);
                            renderPlayers();
                            updateRemainingTeams();
                            saveData();
                        });
                        
                        teamItem.appendChild(removeBtn);
                        teamList.appendChild(teamItem);
                    });
                    
                    const removePlayerBtn = document.createElement('button');
                    removePlayerBtn.className = 'remove-player';
                    removePlayerBtn.innerHTML = '&times;';
                    removePlayerBtn.addEventListener('click', () => {
                        players = players.filter(p => p.name !== player.name);
                        renderPlayers();
                        updateRemainingTeams();
                        saveData();
                    });
                    
                    playerEl.appendChild(removePlayerBtn);
                    playerEl.appendChild(playerTitle);
                    playerEl.appendChild(teamList);
                    playersContainer.appendChild(playerEl);
                });
            }
            
            // إنشاء المباريات
            function generateMatches() {
                matches = [];
                let activeTeams = [];
                
                // جمع جميع الفرق النشطة (غير المغلقة)
                players.forEach(player => {
                    player.teams.forEach(team => {
                        if (!team.eliminated) {
                            activeTeams.push({
                                name: team.name,
                                player: player.name
                            });
                        }
                    });
                });
                
                // إذا كان هناك فريق واحد فقط، فهو الفائز
                if (activeTeams.length === 1) {
                    tournamentStatus.textContent = `الفائز هو ${activeTeams[0].player} بفريقه ${activeTeams[0].name}`;
                    showFinalResults();
                    return;
                }
                
                // إذا كان عدد الفرق فردي، فريق واحد يتأهل تلقائياً
                let byeTeam = null;
                if (activeTeams.length % 2 !== 0) {
                    const randomIndex = Math.floor(Math.random() * activeTeams.length);
                    byeTeam = activeTeams.splice(randomIndex, 1)[0];
                    tournamentStatus.textContent = `${byeTeam.name} (${byeTeam.player}) يتأهل تلقائياً لهذه الجولة`;
                } else {
                    tournamentStatus.textContent = `جولة جديدة مع ${activeTeams.length} فرق`;
                }
                
                // خلط الفرق لإنشاء مباريات عشوائية
                activeTeams = shuffleArray(activeTeams);
                
                // إنشاء المباريات
                for (let i = 0; i < activeTeams.length; i += 2) {
                    if (i + 1 < activeTeams.length) {
                        matches.push({
                            team1: activeTeams[i],
                            team2: activeTeams[i + 1],
                            score1: null,
                            score2: null,
                            winner: null
                        });
                    }
                }
            }
            
            // عرض المباريات
            function renderMatches() {
                matchesContainer.innerHTML = '';
                
                if (matches.length === 0) {
                    generateMatches();
                    if (matches.length === 0) return;
                }
                
                matches.forEach((match, index) => {
                    const matchEl = document.createElement('div');
                    matchEl.className = 'match';
                    
                    const matchTeams = document.createElement('div');
                    matchTeams.className = 'match-teams';
                    
                    const team1El = document.createElement('div');
                    team1El.className = 'match-team';
                    team1El.textContent = `${match.team1.name} (${match.team1.player})`;
                    
                    const vsEl = document.createElement('div');
                    vsEl.className = 'match-vs';
                    vsEl.textContent = 'vs';
                    
                    const team2El = document.createElement('div');
                    team2El.className = 'match-team';
                    team2El.textContent = `${match.team2.name} (${match.team2.player})`;
                    
                    matchTeams.appendChild(team1El);
                    matchTeams.appendChild(vsEl);
                    matchTeams.appendChild(team2El);
                    
                    const matchResult = document.createElement('div');
                    matchResult.className = 'match-result';
                    
                    const score1Input = document.createElement('input');
                    score1Input.type = 'number';
                    score1Input.min = '0';
                    score1Input.placeholder = '0';
                    score1Input.value = match.score1 || '';
                    
                    const score2Input = document.createElement('input');
                    score2Input.type = 'number';
                    score2Input.min = '0';
                    score2Input.placeholder = '0';
                    score2Input.value = match.score2 || '';
                    
                    matchResult.appendChild(score1Input);
                    matchResult.appendChild(document.createTextNode('-'));
                    matchResult.appendChild(score2Input);
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.className = 'match-submit';
                    submitBtn.textContent = 'تأكيد النتيجة';
                    
                    submitBtn.addEventListener('click', () => {
                        const score1 = parseInt(score1Input.value);
                        const score2 = parseInt(score2Input.value);
                        
                        if (isNaN(score1) || isNaN(score2)) {
                            alert('الرجاء إدخال النتيجة الصحيحة');
                            return;
                        }
                        
                        match.score1 = score1;
                        match.score2 = score2;
                        
                        if (score1 > score2) {
                            match.winner = match.team1;
                            eliminateTeam(match.team2);
                        } else if (score2 > score1) {
                            match.winner = match.team2;
                            eliminateTeam(match.team1);
                        } else {
                            // في حالة التعادل، يتم اختيار الفائز عشوائياً
                            const randomWinner = Math.random() < 0.5 ? match.team1 : match.team2;
                            match.winner = randomWinner;
                            eliminateTeam(randomWinner === match.team1 ? match.team2 : match.team1);
                        }
                        
                        // تحديث العرض
                        generateMatches();
                        renderMatches();
                        
                        // حفظ البيانات
                        saveData();
                        
                        // التحقق من وجود فائز
                        checkTournamentWinner();
                    });
                    
                    matchEl.appendChild(matchTeams);
                    matchEl.appendChild(matchResult);
                    matchEl.appendChild(submitBtn);
                    matchesContainer.appendChild(matchEl);
                });
            }
            
            // إقصاء فريق
            function eliminateTeam(team) {
                players.forEach(player => {
                    if (player.name === team.player) {
                        player.teams.forEach(t => {
                            if (t.name === team.name) {
                                t.eliminated = true;
                            }
                        });
                    }
                });
            }
            
            // التحقق من وجود فائز
            function checkTournamentWinner() {
                let remainingPlayers = [];
                
                players.forEach(player => {
                    const activeTeams = player.teams.filter(team => !team.eliminated);
                    if (activeTeams.length > 0) {
                        remainingPlayers.push({
                            player: player.name,
                            teams: activeTeams.map(t => t.name),
                            count: activeTeams.length
                        });
                    }
                });
                
                if (remainingPlayers.length === 1) {
                    const winner = remainingPlayers[0];
                    tournamentStatus.textContent = `الفائز هو ${winner.player} مع ${winner.count} فريق/فرق باقية!`;
                    showFinalResults(winner);
                    saveData();
                } else if (remainingPlayers.length === 0) {
                    tournamentStatus.textContent = 'انتهت البطولة بدون فائز!';
                    showFinalResults();
                    saveData();
                }
            }
            
            // عرض النتائج النهائية
            function showFinalResults(winner = null) {
                tournamentSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                
                finalResults.innerHTML = '';
                
                if (winner) {
                    const winnerEl = document.createElement('div');
                    winnerEl.className = 'player winner';
                    winnerEl.innerHTML = `
                        <h3>الفائز: ${winner.player}</h3>
                        <p>عدد الفرق المتبقية: ${winner.count}</p>
                        <ul class="team-list">
                            ${winner.teams.map(team => `<li>${team}</li>`).join('')}
                        </ul>
                    `;
                    finalResults.appendChild(winnerEl);
                }
                
                const playersResults = document.createElement('div');
                playersResults.innerHTML = '<h3>جميع اللاعبين وفرقهم:</h3>';
                
                players.forEach(player => {
                    const playerEl = document.createElement('div');
                    playerEl.className = 'player';
                    playerEl.innerHTML = `
                        <h3>${player.name}</h3>
                        <ul class="team-list">
                            ${player.teams.map(team => `
                                <li class="${team.eliminated ? 'loser' : 'winner'}">
                                    ${team.name} ${team.eliminated ? '(خاسر)' : '(فائز)'}
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    playersResults.appendChild(playerEl);
                });
                
                finalResults.appendChild(playersResults);
                
                const restartBtn = document.createElement('button');
                restartBtn.textContent = 'بدء بطولة جديدة';
                restartBtn.addEventListener('click', () => {
                    // حذف البيانات من Firebase
                    db.collection("tournaments").doc("current").delete()
                        .then(() => {
                            location.reload();
                        })
                        .catch((error) => {
                            console.error("Error deleting tournament:", error);
                            location.reload();
                        });
                });
                finalResults.appendChild(restartBtn);
            }
            
            // دالة لخلط المصفوفة عشوائياً
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            // تهيئة التطبيق
            initApp();
        });
    </script>
</body>
</html>
